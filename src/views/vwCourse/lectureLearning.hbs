<div class="container-fluid">
    <div class="row">
        <!-- Sidebar với danh sách bài giảng -->
        <div class="col-lg-3 col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list"></i> Nội dung khóa học
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="course-progress mb-3 p-3 bg-light">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="text-muted">Tiến độ khóa học</small>
                            <small class="fw-bold">{{courseProgress.progressPercentage}}%</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{courseProgress.progressPercentage}}%"></div>
                        </div>
                        <small class="text-muted">
                            {{courseProgress.completedLectures}}/{{courseProgress.totalLectures}} chương đã hoàn thành
                        </small>
                    </div>
                    
                    <div class="lecture-list">
                        {{#each allLectures}}
                        <div class="lecture-item {{#if (eq this.id ../lecture.id)}}active{{/if}}">
                            <a href="/courses/{{../course.course_id}}/lecture/{{this.id}}" 
                               class="d-flex align-items-center p-3 text-decoration-none {{#if (eq this.id ../lecture.id)}}bg-primary text-white{{else}}text-dark{{/if}}">
                                <div class="lecture-icon me-3">
                                    {{#if (eq this.id ../lecture.id)}}
                                        <i class="fas fa-play-circle text-white"></i>
                                    {{else}}
                                        <i class="fas fa-play-circle text-muted"></i>
                                    {{/if}}
                                </div>
                                <div class="lecture-content flex-grow-1">
                                    <h6 class="mb-1 {{#if (eq this.id ../lecture.id)}}text-white{{else}}text-dark{{/if}}">
                                        {{this.lecture_title}}
                                    </h6>
                                    <small class="{{#if (eq this.id ../lecture.id)}}text-white-50{{else}}text-muted{{/if}}">
                                        {{this.videos.length}} video
                                    </small>
                                </div>
                                <div class="lecture-status">
                                    {{#if (eq this.id ../lecture.id)}}
                                        <i class="fas fa-check-circle text-white"></i>
                                    {{else}}
                                        <i class="fas fa-circle text-muted"></i>
                                    {{/if}}
                                </div>
                            </a>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content với video player -->
        <div class="col-lg-9 col-md-8">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-1">{{lecture.lecture_title}}</h4>
                            <small class="text-muted">{{course.title}} - {{course.instructor_name}}</small>
                        </div>
                        <div class="lecture-navigation">
                            {{#if previousLecture}}
                            <a href="/courses/{{course.course_id}}/lecture/{{previousLecture.id}}" 
                               class="btn btn-outline-secondary btn-sm me-2">
                                <i class="fas fa-chevron-left"></i> Bài trước
                            </a>
                            {{/if}}
                            {{#if nextLecture}}
                            <a href="/courses/{{course.course_id}}/lecture/{{nextLecture.id}}" 
                               class="btn btn-primary btn-sm">
                                Bài tiếp <i class="fas fa-chevron-right"></i>
                            </a>
                            {{/if}}
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- Video Player -->
                    <div class="video-container mb-4">
                        {{#if currentVideo}}
                        <video id="player" 
                               class="plyr-video w-100" 
                               controls 
                               crossorigin 
                               playsinline 
                               poster="{{currentVideo.thumbnail_url}}">
                            <source src="{{currentVideo.video_url}}" type="video/mp4">
                            <p>Trình duyệt của bạn không hỗ trợ video HTML5.</p>
                        </video>
                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>Debug:</strong> Video URL: {{currentVideo.video_url}}
                            </small>
                        </div>
                        {{else if lecture.videos.length}}
                        <!-- Fallback: Sử dụng video đầu tiên trong chương -->
                        <video id="player" 
                               class="plyr-video w-100" 
                               controls 
                               crossorigin 
                               playsinline>
                            <source src="{{lecture.videos.0.video_url}}" type="video/mp4">
                            <p>Trình duyệt của bạn không hỗ trợ video HTML5.</p>
                        </video>
                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>Debug:</strong> Video URL: {{lecture.videos.0.video_url}}
                            </small>
                        </div>
                        {{else}}
                        <div class="video-placeholder bg-light d-flex align-items-center justify-content-center" style="height: 400px;">
                            <div class="text-center">
                                <i class="bi bi-play-circle text-muted" style="font-size: 4rem;"></i>
                                <h5 class="mt-3 text-muted">Video đang được cập nhật</h5>
                                <p class="text-muted">Nội dung video cho chương này sẽ sớm được cập nhật.</p>
                                {{#if lecture.videos.length}}
                                <div class="mt-3">
                                    <small class="badge bg-info me-2">Video ID: {{lecture.videos.0.id}}</small>
                                    <small class="badge bg-info">Thời lượng: {{lecture.videos.0.duration}} giây</small>
                                </div>
                                {{/if}}
                            </div>
                        </div>
                        {{/if}}
                    </div>

                    <!-- Video List trong chương -->
                    {{#if lecture.videos}}
                    <div class="video-list">
                        <h6 class="mb-3">
                            <i class="fas fa-video"></i> Danh sách video trong chương
                        </h6>
                        <div class="list-group">
                            {{#each lecture.videos}}
                            <div class="list-group-item video-item {{#if @first}}active{{/if}}" 
                                 data-video-id="{{this.id}}" 
                                 data-video-url="{{this.video_url}}"
                                 data-video-title="{{this.video_title}}">
                                <div class="d-flex align-items-center">
                                    <div class="video-thumbnail me-3">
                                        {{#if this.thumbnail_url}}
                                        <img src="{{this.thumbnail_url}}" 
                                             alt="{{this.video_title}}" 
                                             class="rounded video-thumb" 
                                             style="width: 60px; height: 40px; object-fit: cover;">
                                        {{else}}
                                        <div class="video-thumb-placeholder rounded d-flex align-items-center justify-content-center bg-light" 
                                             style="width: 60px; height: 40px;">
                                            <i class="fas fa-play text-muted"></i>
                                        </div>
                                        {{/if}}
                                    </div>
                                    <div class="video-info flex-grow-1">
                                        <h6 class="mb-1">{{this.video_title}}</h6>
                                        <small class="text-muted">
                                            <i class="fas fa-clock"></i> {{format_time this.duration}}
                                        </small>
                                    </div>
                                    <div class="video-status">
                                        <i class="fas fa-play-circle text-primary"></i>
                                    </div>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{else}}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Chương này chưa có video nào.
                    </div>
                    {{/if}}

                    <!-- Mô tả chương -->
                    {{#if lecture.description}}
                    <div class="lecture-description mt-4">
                        <h6><i class="fas fa-info-circle"></i> Mô tả chương</h6>
                        <p class="text-muted">{{lecture.description}}</p>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Plyr.io CSS -->
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
<link rel="stylesheet" href="/css/lecture-learning.css" />

<!-- Plyr.io JavaScript -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script src="/js/lecture-learning.js"></script>
