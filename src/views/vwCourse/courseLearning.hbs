{{!-- Trang học theo chương - Danh sách chương --}}
<div class="container-fluid py-4">
    <div class="row">
        {{!-- Sidebar - Danh sách chương --}}
        <div class="col-lg-4 col-md-5">
            <div class="course-sidebar bg-white rounded shadow-sm p-3 sticky-top" style="top: 20px;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">
                        <i class="bi bi-list-ul"></i> Nội dung khóa học
                    </h5>
                    <span class="badge bg-primary">{{courseProgress.totalLectures}} chương</span>
                </div>

                {{!-- Progress Overview --}}
                <div class="progress-overview mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">Tiến độ tổng thể</small>
                        <small class="fw-bold text-primary">{{courseProgress.progressPercentage}}%</small>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{courseProgress.progressPercentage}}%">
                        </div>
                    </div>
                    <small class="text-muted d-block mt-1">
                        {{courseProgress.completedLectures}}/{{courseProgress.totalLectures}} chương đã hoàn thành
                    </small>
                </div>

                {{!-- Course Header --}}
                <div class="course-header mb-3 p-3 bg-primary text-white rounded">
                    <h6 class="mb-1">{{course.title}}</h6>
                    <small class="opacity-75">{{course.instructor_name}}</small>
                </div>

                {{!-- Lecture List --}}
                <div class="lecture-list">
                    {{#each lectures}}
                    <div class="lecture-item mb-2">
                        <a href="/enrollment/{{../course.course_id}}/learn/{{this.id}}" 
                           class="lecture-link text-decoration-none d-flex align-items-center p-3 rounded hover-bg-light">
                            <div class="lecture-icon me-3">
                                {{#if (eq this.progress.progressPercentage 100)}}
                                    <i class="bi bi-check-circle-fill text-success fs-5"></i>
                                {{else if this.progress.progressPercentage}}
                                    <i class="bi bi-play-circle-fill text-primary fs-5"></i>
                                {{else}}
                                    <i class="bi bi-play-circle text-muted fs-5"></i>
                                {{/if}}
                            </div>
                            <div class="lecture-info flex-grow-1">
                                <div class="lecture-title fw-semibold mb-1">{{this.title}}</div>
                                <div class="lecture-meta text-muted small mb-2">
                                    <i class="bi bi-clock"></i> {{this.time}} phút
                                    {{#if this.is_preview}}
                                        <span class="badge bg-warning text-dark ms-2">Preview</span>
                                    {{/if}}
                                </div>
                                
                                {{!-- Progress Bar for Lecture --}}
                                {{#if this.progress.totalVideos}}
                                <div class="lecture-progress">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <small class="text-muted">Tiến độ</small>
                                        <small class="fw-bold text-primary">{{this.progress.progressPercentage}}%</small>
                                    </div>
                                    <div class="progress" style="height: 4px;">
                                        <div class="progress-bar bg-primary" role="progressbar" 
                                             style="width: {{this.progress.progressPercentage}}%">
                                        </div>
                                    </div>
                                    <small class="text-muted">
                                        {{this.progress.completedVideos}}/{{this.progress.totalVideos}} video
                                    </small>
                                </div>
                                {{/if}}
                            </div>
                        </a>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>

        {{!-- Main Content - Course Overview --}}
        <div class="col-lg-8 col-md-7">
            <div class="learning-content">
                {{!-- Course Header --}}
                <div class="course-header bg-white rounded shadow-sm p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h3 class="course-title mb-2">{{course.title}}</h3>
                            <p class="text-muted mb-0">
                                <i class="bi bi-person"></i> {{course.instructor_name}} | 
                                <i class="bi bi-tag"></i> {{course.category_name}}
                            </p>
                        </div>
                        <a href="/courses/{{course.course_id}}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Quay lại
                        </a>
                    </div>
                </div>

                {{!-- Course Description --}}
                <div class="course-description bg-white rounded shadow-sm p-4 mb-4">
                    <h5 class="mb-3">Giới thiệu khóa học</h5>
                    <p class="text-muted">{{course.description}}</p>
                    
                    {{#if course.full_description}}
                    <div class="mt-4">
                        <h6>Bạn sẽ học được gì:</h6>
                        <ul class="list-unstyled">
                            {{#each course.full_description.what_you_will_learn}}
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                {{this}}
                            </li>
                            {{/each}}
                        </ul>
                    </div>
                    {{/if}}
                </div>

                {{!-- Course Stats --}}
                <div class="course-stats bg-white rounded shadow-sm p-4">
                    <h5 class="mb-3">Thống kê khóa học</h5>
                    <div class="row text-center">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-item">
                                <i class="bi bi-play-circle text-primary fs-1"></i>
                                <div class="fw-bold">{{courseProgress.totalLectures}}</div>
                                <small class="text-muted">Chương học</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-item">
                                <i class="bi bi-clock text-info fs-1"></i>
                                <div class="fw-bold">{{course.total_hours}}</div>
                                <small class="text-muted">Giờ học</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-item">
                                <i class="bi bi-people text-success fs-1"></i>
                                <div class="fw-bold">{{course.total_enrollment}}</div>
                                <small class="text-muted">Học viên</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-item">
                                <i class="bi bi-star text-warning fs-1"></i>
                                <div class="fw-bold">{{course.rating}}</div>
                                <small class="text-muted">Đánh giá</small>
                            </div>
                        </div>
                    </div>
                </div>

                {{!-- Start Learning Button --}}
                {{#if lectures.length}}
                <div class="text-center mt-4">
                    <a href="/enrollment/{{course.course_id}}/learn/{{lectures.0.id}}" 
                       class="btn btn-primary btn-lg">
                        <i class="bi bi-play-circle"></i> Bắt đầu học
                    </a>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</div>

<style>
.course-sidebar {
    max-height: calc(100vh - 100px);
    overflow-y: auto;
}

.lecture-link {
    transition: all 0.2s ease;
    border: 1px solid #f0f0f0;
}

.lecture-link:hover {
    background-color: #f8f9fa !important;
    border-color: #dee2e6;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.progress-overview {
    border: 1px solid #e9ecef;
}

.stat-item {
    padding: 1rem;
}

.stat-item i {
    margin-bottom: 0.5rem;
}

.lecture-progress {
    background-color: #f8f9fa;
    padding: 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid #e9ecef;
}

@media (max-width: 768px) {
    .course-sidebar {
        max-height: 400px;
        margin-bottom: 1rem;
    }
    
    .stat-item {
        padding: 0.5rem;
    }
    
    .stat-item i {
        font-size: 2rem !important;
    }
}
</style>
